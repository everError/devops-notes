# Harbor 문서

---

## 1. Harbor 개요

Harbor는 **컨테이너 이미지와 Helm 차트를 위한 오픈 소스 프라이빗 레지스트리**입니다. 클라우드 네이티브 환경에서 컨테이너 이미지를 안전하고 효율적으로 관리하기 위해 설계되었으며, 엔터프라이즈 환경의 요구 사항을 충족하는 다양한 보안 및 관리 기능을 제공합니다. CNCF(Cloud Native Computing Foundation)의 졸업 프로젝트로, 신뢰성과 안정성이 검증되었습니다.

---

## 2. 주요 기능

Harbor는 단순한 이미지 저장소를 넘어, 다음과 같은 핵심 기능들을 포함합니다.

- **이미지 관리:** Docker 및 OCI(Open Container Initiative) 호환 이미지와 Helm 차트를 중앙 집중식으로 관리할 수 있습니다.
- **보안 취약점 스캔:** Trivy와 같은 스캐너를 통합하여, 이미지를 푸시할 때마다 자동으로 보안 취약점을 검사하고 보고서를 생성합니다.
- **접근 제어 (RBAC):** 사용자 및 팀에 기반한 역할 기반 접근 제어(Role-Based Access Control)를 통해 레지스트리 내의 프로젝트에 대한 접근 권한을 세분화하여 관리할 수 있습니다.
- **콘텐츠 신뢰성:** Notary 또는 Cosign을 사용하여 이미지에 대한 디지털 서명을 지원하며, 서명된 이미지만 풀(pull)할 수 있도록 강제하여 이미지의 무결성을 보장합니다.
- **이미지 복제 (Replication):** 여러 Harbor 인스턴스 또는 다른 레지스트리(Docker Hub, AWS ECR 등) 간에 이미지를 자동으로 동기화할 수 있습니다.
- **가비지 컬렉션:** 사용하지 않는 이미지를 주기적으로 정리하여 저장 공간을 효율적으로 관리할 수 있습니다.

---

## 3. 아키텍처

Harbor는 여러 도커 컨테이너로 구성된 분산 시스템입니다. 주요 컴포넌트들은 다음과 같습니다.

- **Proxy:** Nginx 기반의 리버스 프록시로, 모든 요청을 처리하여 각 컴포넌트로 전달합니다.
- **UI:** 사용자 인터페이스를 제공하는 웹 서비스입니다.
- **Core:** 백엔드 서비스의 핵심 로직을 담당합니다.
- **Registry:** 컨테이너 이미지를 저장하고 관리하는 핵심 컴포넌트입니다.
- **Database:** PostgreSQL을 사용하여 Harbor의 메타데이터를 저장합니다.
- **Redis:** 캐시 및 세션 관리를 담당합니다.
- **JobService:** 이미지 복제, 가비지 컬렉션, 스캔 등의 작업을 처리하는 워커입니다.
- **Trivy:** 이미지 보안 취약점을 스캔하는 컨테이너입니다.

---

## 4. 최신 버전 및 설치

Harbor의 최신 버전은 **v2.13.2**이며, 2025년 7월 31일에 릴리스되었습니다. 이 버전은 주로 Go 언어 및 Trivy와 같은 종속 컴포넌트의 업데이트를 포함합니다.

Harbor의 공식 설치 방법은 **오프라인 설치 패키지**를 사용하는 것입니다. 이 패키지에는 Harbor를 구성하는 모든 도커 이미지와 `docker compose` 파일, 그리고 설치를 자동화하는 `install.sh` 스크립트가 포함되어 있습니다.

**설치 절차:**

1.  Harbor 공식 릴리스 페이지에서 최신 `harbor-offline-installer-vX.Y.Z.tgz` 파일을 다운로드합니다.
2.  다운로드한 파일을 원하는 설치 경로에 압축 해제합니다.
3.  `harbor.yml.tmpl`을 복사하여 `harbor.yml`을 생성하고, `hostname`과 `data_volume` 등 설정을 편집합니다.
4.  `install.sh` 스크립트를 실행하여 설치를 완료합니다. 이 스크립트가 `docker compose`를 사용하여 Harbor의 모든 컨테이너를 올바르게 배포합니다.
